<?xml version="1.0" encoding="utf-8" ?>
<packagegui>
	<name>postfix</name>
        <donotsave>false</donotsave>
        <preoutput>yes</preoutput>
        <savetext>Change</savetext>
	<!-- Menu is where this packages menu will appear -->
	<menu>
		<name>Postfix Settings</name>
		<tooltiptext>Configure Postfix Forwarder</tooltiptext>
		<section>Services</section>
		<configfile>postfix.xml</configfile>
	</menu>
        <!-- Do not save invokes a simple input menu and will not update
             the configuration database. -->
	<fields>
		<field>
			<fielddescr>Primary Domain</fielddescr>
			<fieldname>primarydomain</fieldname>
			<description>Enter your primary domain.  (ex: example.com)</description>
			<type>input</type>
		</field>
		<field>
			<fielddescr>My Hostname</fielddescr>
			<fieldname>hostname</fieldname>
			<description>Enter the hostname of this system to be used by Postfix.  (ex: mail.example.com)</description>
                        <type>input</type>
		</field>
		<field>
		    <type>rowhelper</type>
		    <rowhelper>
			<rowhelperfield>
        		    <fielddescr>Domain</fielddescr>
        		    <fieldname>domain</fieldname>
        		    <description>Enter the domain here (ex: example.com)</description>
        		    <type>input</type>
			</rowhelperfield>
			<rowhelperfield>
			    <fielddescr>Mail Server IP</fielddescr>
        		    <fieldname>mailserverip</fieldname>
        		    <description>Enter the mail server IP to forward to here.</description>
        		    <type>input</type>
			</rowhelperfield>
		    </rowhelper>
		</field>
        </fields>
	<!-- fields gets invoked when the user adds or edits a item.   the following items
         will be parsed and rendered for the user as a gui with input, and selectboxes. -->
	<custom_add_php_command>
	</custom_add_php_command>
	<custom_php_deinstall_command>
	</custom_php_deinstall_command>
	<custom_php_install_command>
	</custom_php_install_command>
        <templates>
            <template>
                <filename>/usr/local/etc/postfix/main.cf</filename>
                <templatecontents>
                    myhostname = hostname_fieldvalue\n
                    mydomain = primarydomain_fieldvalue\n
                    relay_domains = domain_fieldvalue[1-$domain_total_rows]
                </templatecontents>
            </template>
            <template>
                <filename>/usr/local/etc/postfix/transport</filename>
                <templatecontents>domain_fieldvalue smtp:[mailserverip_fieldvalue]</templatecontents>
            </template>
        </templates>
        <start_command>/usr/local/sbin/postfix start</start_command>
        <restart_command>/usr/local/sbin/postmap /usr/local/etc/postfix/transport ; /usr/local/sbin/postfix reload</restart_command>
                
</packagegui>