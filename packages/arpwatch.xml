<packagegui>
	<name>arpwatch</name>
	<title>arpwatch: Settings</title>
	<version>2.1.a13</version>
	<configpath>installedpackages->package->$packagename->configuration->settings</configpath>
	<aftersaveredirect>pkg_edit.php?xml=arpwatch.xml&amp;id=0</aftersaveredirect>
	<menu>
                <name>arpwatch</name>
                <tooltiptext>Modify arpwatch settings.</tooltiptext>
                <section>Services</section>
                <configfile>arpwatch.xml</configfile>
                <url>/pkg_edit.php?xml=arpwatch.xml&amp;id=0</url>
        </menu>
	<service>
                <name>arpwatch</name>
                <rcfile>arpwatch.sh</rcfile>
                <executable>arpwatch</executable>
        </service>
	<fields>
		<field>
			<fielddescr>Listening Interface</fielddescr>
			<fieldname>interface</fieldname>
			<description>Enter the desired listening interface here.</description>
			<type>interfaces_selection</type>
		</field>
	</fields>
	<custom_php_install_command>
		unlink_if_exists("/usr/local/etc/rc.d/arpwatch.sh");
        </custom_php_install_command>
	<custom_php_global_functions>
	function sync_package_arpwatch() {
                conf_mount_rw();
                config_lock();
                global $config;
		$int = convert_friendly_interface_to_real_interface_name($config['installedpackages']['arpwatch']['config'][0]['interface']);
		$start = "/usr/local/sbin/arpwatch -d -i {$_POST['$int']} &amp;";
		$stop = "/usr/bin/killall arpwatch";
		write_rcfile(array(
			"file" => "arpwatch.sh",
			"start" => $start,
			"stop" =>  $stop
			)
		);
		restart_service("arpwatch");
                conf_mount_ro();
                config_unlock();
        }
	</custom_php_global_functions>
	<custom_add_php_command>
		sync_package_arpwatch();
	</custom_add_php_command>
</packagegui>

