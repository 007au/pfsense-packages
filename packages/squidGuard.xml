<?xml version="1.0" encoding="utf-8" ?>
<packagegui>
	<name>squidGuard</name>
	<configpath>installedpackages->package->$packagename->configuration->settings</configpath>
	<custom_php_install_command>
	    $fout = fopen("/usr/local/etc/squid/squidGuard.conf","w");
	    fwrite($fout, "# This configuration was generated by the pfSense package manager.\n");
	    fwrite($fout, "# cat squidGuard.conf\n\n");
	    fwrite($fout, "dbhome /var/db/squidGuard\n");
	    fwrite($fout, "logdir /usr/local/squid/logs\n");
	    fwrite($fout, "acl {\n");
	    fwrite($fout, "\t default {\n");
	    fwrite($fout, "\t pass all\n");
	    fwrite($fout, "\t }\n");
	    fwrite($fout, "}\n");
	    fclose($fout);
	    sync_package("squid");
	    $fout = fopen("/usr/local/etc/squid/squid.conf","a");
	    fwrite($fout, "redirect_program /usr/local/bin/squidGuard -c /usr/local/etc/squid/squidGuard.conf\\n");
	    fwrite($fout, "redirect_children 4\n");
	    fclose($fout);
	    mwexec("/usr/bin/touch /usr/local/squid/logs/squidGuard.log");
	    mwexec("/usr/sbin/chown squid /usr/local/squid/logs/squidGuard.log");
	    mwexec("/usr/bin/chgrp squid /usr/local/squid/logs/squidGuard.log");
	    mwexec("/bin/chmod 744 /usr/local/squid/logs/squidGuard.log");
	    mwexec("/usr/bin/touch /var/log/squidGuard.log");
	    mwexec("/usr/sbin/chown squid /var/log/squidGuard.log");
	    mwexec("/usr/bin/chgrp squid /var/log/squidGuard.log");
	    mwexec("/bin/chmod 744 /var/log/squidGuard.log");
	    mwexec("/usr/sbin/chown -R squid /var/db/squidGuard");
	    mwexec("/usr/bin/chgrp -R squid /var/db/squidGuard");
	    mwexec("/bin/chmod -R 755 /var/db/squidGuard");
	    system("/usr/local/sbin/squid -k reconfigure");
	</custom_php_install_command>
	<custom_php_deinstall_command>
	    unlink_if_exists("/var/log/squidGuard.log");
	    rmdir_recursive("/var/db/squidGuard");
	    sync_package("squid");
        </custom_php_deinstall_command>
    	<process_kill_command>squid</process_kill_command>
</packagegui>
