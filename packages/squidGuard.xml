<?xml version="1.0" encoding="utf-8"?>
<packagegui>
	<name>squidGuard</name>
	<custom_php_install_command>
		$fout = fopen("/usr/local/etc/squid/squidGuard.conf","w");
		fwrite($fout, "# This configuration was generated by the pfSense package manager.\n");
		fwrite($fout, "logdir /usr/local/squid/logs\n");
		fwrite($fout, "dbhome /var/db/squidGuard\n");
		fwrite($fout, "dest ads {\n");
		fwrite($fout, "\t domainlist\t ads/domains\n");
		fwrite($fout, "\t urllist\t ads/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest aggressive {\n");
		fwrite($fout, "\t domainlist\t aggressive/domains\n");
		fwrite($fout, "\t urllist\t aggressive/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest audio-video {\n");
		fwrite($fout, "\t domainlist\t audio-video/domains\n");
		fwrite($fout, "\t urllist\t audio-video/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest drugs {\n");
		fwrite($fout, "\t domainlist\t drugs/domains\n");
		fwrite($fout, "\t urllist\t drugs/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest gambling {\n");
		fwrite($fout, "\t domainlist\t gambling/domains\n");
		fwrite($fout, "\t urllist\t gambling/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest hacking {\n");
		fwrite($fout, "\t domainlist\t hacking/domains\n");
		fwrite($fout, "\t urllist\t hacking/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest mail {\n");
		fwrite($fout, "\t domainlist\t mail/domains\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest porn {\n");
		fwrite($fout, "\t domainlist\t porn/domains\n");
		fwrite($fout, "\t urllist\t porn/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest proxy {\n");
		fwrite($fout, "\t domainlist\t proxy/domains\n");
		fwrite($fout, "\t urllist\t proxy/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest violence {\n");
		fwrite($fout, "\t domainlist\t violence/domains\n");
		fwrite($fout, "\t urllist\t violence/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "dest warez {\n");
		fwrite($fout, "\t domainlist\t warez/domains\n");
		fwrite($fout, "\t urllist\t warez/urls\n");
		fwrite($fout, "}\n");
		fwrite($fout, "acl {\n");
		fwrite($fout, "\t default {\n");
		fwrite($fout, "\t pass !ads !aggressive !audio-video !drugs !gambling !hacking !mail !porn !proxy !violence !warez all\n");
		fwrite($fout, "\t redirect http://bkw.lindesign.se/tmp/denied.html");
		fwrite($fout, "\t }\n");
		fwrite($fout, "}\n");	
		fclose($fout);
        add_text_to_file("/usr/local/etc/squid/squid.conf", "redirect_program /usr/local/bin/squidGuard -c /usr/local/etc/squid/squidGuard.conf");
        /* $fout = fopen("/usr/local/etc/squid/squid.conf","a");
		fwrite($fout, "redirect_program /usr/local/bin/squidGuard -c /usr/local/etc/squid/squidGuard.conf\n");
		fclose($fout); */
		mwexec("/usr/bin/touch /usr/local/squid/logs/squidGuard.log");
		mwexec("/usr/sbin/chown squid /usr/local/squid/logs/squidGuard.log");
		mwexec("/usr/bin/chgrp squid /usr/local/squid/logs/squidGuard.log");
		mwexec("/bin/chmod 744 /usr/local/squid/logs/squidGuard.log");
		mwexec("/usr/sbin/chown -R squid /var/db/squidGuard");
		mwexec("/usr/bin/chgrp -R squid /var/db/squidGuard");
		mwexec("/usr/local/sbin/squid -k reconfigure");
	</custom_php_install_command>
	<custom_php_deinstall_command>
		unlink_if_exists("/var/log/squidGuard.log");
		rmdir_recursive("/var/db/squidGuard");
		remove_text_from_file("/usr/local/etc/squid/squid.conf", "redirect_program /usr/local/bin/squidGuard -c /usr/local/etc/squid/squidGuard.conf");
        mwexec("/usr/local/sbin/squid -k reconfigure");
        </custom_php_deinstall_command>
	<process_kill_command>squid</process_kill_command>
</packagegui>
